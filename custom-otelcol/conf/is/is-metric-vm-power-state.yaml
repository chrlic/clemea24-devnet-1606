queries:
- name: Intersight VM Power State
  resource:
    name: Intersight
    attributes:
    - name: is.fabric.name
      value: PRG-DC
    - name: is.entity
      value: Server
  scope:
    name: intersight-scrapper
    version: 1.0.0
  rules:
    query: /api/v1/virtualization/VirtualMachines
    select: /Results
    forEach:
      emitMetric:
      - name: power.status
        unit: one
        type: gauge # sum/gauge
        # monotonic: true
        # temporality: cumulative # cumulative/delta
        valueFrom: =jqs("/PowerState")=="PowerOn"?1:0
        resourceAttributes:
        - name: is.vm.name
          valueFrom: /Name
        - name: is.vm.moid
          valueFrom: /Moid
